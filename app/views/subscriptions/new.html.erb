<div class="container">
<h1>Subscribe to this offering</h1>
<%= link_to "Back to the project", project_path(@project) %>
<h3>Other investors present on this deal:</h3>

<% stacked_bar = [] %>
<% @users.each do |user| %>
  <% user_project_amount = user.subscriptions.where(project: @project).sum(&:amount) %>
  <div class="row">
    <div class="col-6">
      <div class="user-box"><%= cl_image_tag user.photo.key, height: 50, width: 50, crop: :fill %> <%= user.name %> :
        <%= number_to_currency(user_project_amount) %>
        <% user_percentage = 100 * user_project_amount / @project.amount %>
        <%= user_percentage = user_percentage.round(1) %>
        <% stacked_bar << user_percentage %>
        <div class="progress">
          <div class="progress-bar" role="progressbar" style="width: <%= user_percentage %>%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <p> </p>
      </div>
    </div>
  </div>
<% end %>

<p class="card-small-text">Commited: <%= @project.percentage_subscribed * 100 %>%</p>
  <% commited = @project.percentage_subscribed * 100 %>
  
<%#  Stacked progress bar %>
  <%# <div class="progress"> %>
    <%# <div class="progress-bar" role="progressbar" style="width: 15%" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div> %>
    <%# <div class="progress-bar bg-success" role="progressbar" style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div> %>
    <%# <div class="progress-bar bg-info" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div> %>
  <%# </div> %>
<%#  Stacked progress bar END %>

<div class="progress">
  <div class="progress-bar" role="progressbar" style="width: <%= commited %>%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
</div>

  <%= simple_form_for [@project, @subscription] do |f| %>
      <%= f.input :amount, :label => "Choose the amount (maximum #{number_to_currency(@max_amount)}):" %>
      <%= f.button :submit %>
  <% end %>
</div>
